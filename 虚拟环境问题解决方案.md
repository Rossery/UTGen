# 跨目录工作区问题解决方案

## 🔍 问题分析

您的实际使用场景：
- **工作区目录**：`/Users/edy/Desktop/华为/canndev-utgen` （源码所在）
- **扩展目录**：`/Users/edy/Desktop/华为/utgen-v2/extension` （工具所在）
- **脚本目录**：`/Users/edy/Desktop/华为/utgen-v2` （脚本和虚拟环境所在）

这种跨目录的使用场景导致了路径查找问题。

## ✅ 已实现的解决方案

我已经修改了扩展代码，现在支持跨目录工作：

### 🎯 核心改进

1. **智能路径解析**
   - 脚本路径：自动使用 `utgen-v2/entrypoint.sh`
   - 虚拟环境：优先使用 `utgen-v2/.venv`
   - 工作目录：在 `utgen-v2` 目录执行脚本

2. **虚拟环境查找顺序**
   - 首选：`/Users/edy/Desktop/华为/utgen-v2/.venv`
   - 备选：工作区目录的 `.venv`
   - 降级：系统 Python 环境

3. **自动适配**
   - 无需手动配置路径
   - 自动检测并使用正确的虚拟环境
   - 支持跨目录的源码引用

### 🚀 使用方法

现在您可以直接使用，无需特殊配置：

1. **在任何目录打开 VSCode**
   ```bash
   code /Users/edy/Desktop/华为/canndev-utgen
   ```

2. **运行扩展**
   - 按 F5 启动扩展
   - 运行命令：`CANN 测试用例生成器: 打开面板`
   - 输入算子名称和源码路径

3. **系统会自动**
   - 找到并使用 `utgen-v2/.venv` 虚拟环境
   - 执行 `utgen-v2/entrypoint.sh` 脚本
   - 在正确的目录运行工具

## 🎯 改进后的代码特性

我已经更新了代码，使其更加健壮：

1. **自动检测虚拟环境**
   - 检查工作区目录的 `.venv`
   - 检查父目录的 `.venv`
   - 检查当前目录的 `.venv`

2. **优雅的降级处理**
   - 如果找不到虚拟环境，会使用系统 Python
   - 输出清晰的警告信息

3. **详细的调试信息**
   - 显示工作区路径
   - 显示虚拟环境路径
   - 显示执行的脚本路径

## 📋 检查清单

运行检查脚本查看环境状态：
```bash
cd /Users/edy/Desktop/华为/utgen-v2
./check_venv.sh
```

## 💡 最佳实践

1. **统一工作环境**
   - 将所有相关文件放在 `utgen-v2` 目录
   - 确保 VSCode 始终打开此目录

2. **虚拟环境管理**
   - 在项目根目录创建虚拟环境
   - 使用 `activate.sh` 脚本激活

3. **配置文件**
   - 在 `config.sh` 中设置 API 配置
   - 不要在界面中输入敏感信息
